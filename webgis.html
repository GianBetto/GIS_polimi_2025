<!DOCTYPE HTML>
<!--
	WebGIS - Air Quality Mapping Project
	GIS Lab Project 2024/25
-->
<html>
	<head>
		<title>Interactive WebGIS - Air Quality Mapping</title>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
		<link rel="stylesheet" href="assets/css/main.css" />
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ol@8.2.0/ol.css" type="text/css">
		<noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
		<style>
			#map {
				width: 100%;
				height: 600px;
				border: 2px solid #ddd;
				border-radius: 4px;
			}
			.map-controls {
				margin: 1em 0;
				padding: 1em;
				background: #f8f8f8;
				border-radius: 4px;
			}
			.layer-control {
				margin: 0.5em 0;
			}
			.legend {
				background: white;
				padding: 1em;
				border: 1px solid #ddd;
				border-radius: 4px;
				margin-top: 1em;
			}
			.bivariate-legend {
				display: grid;
				grid-template-columns: repeat(5, 1fr);
				gap: 2px;
				max-width: 200px;
			}
			.legend-cell {
				width: 30px;
				height: 30px;
				border: 1px solid #ccc;
				font-size: 8px;
				display: flex;
				align-items: center;
				justify-content: center;
			}
		</style>
	</head>
	<body class="is-preload">

		<!-- Header -->
			<header id="header">
				<a href="index.html" class="title">Air Quality Mapping</a>
				<nav>
					<ul>
						<li><a href="index.html">Home</a></li>
						<li><a href="no2.html">NO₂</a></li>
						<li><a href="pm25.html">PM2.5</a></li>
						<li><a href="pm10.html">PM10</a></li>
						<li><a href="webgis.html" class="active">WebGIS</a></li>
					</ul>
				</nav>
			</header>

		<!-- Wrapper -->
			<div id="wrapper">

				<!-- Main -->
					<section id="main" class="wrapper">
						<div class="inner">
							<h1 class="major">Interactive WebGIS</h1>
							<p>Explore air quality data through our interactive web mapping application. Use the controls below to switch between different pollutants, view bivariate maps, and analyze population exposure patterns.</p>

							<!-- Map Controls -->
							<div class="map-controls">
								<div class="row">
									<div class="col-3 col-12-medium">
										<h3>Pollutant Layers</h3>
										<div class="layer-control">
											<input type="radio" id="no2-layer" name="pollutant" value="no2" checked>
											<label for="no2-layer">NO₂ Concentration (2020)</label>
										</div>
										<div class="layer-control">
											<input type="radio" id="pm25-layer" name="pollutant" value="pm25">
											<label for="pm25-layer">PM2.5 Concentration (2020)</label>
										</div>
										<div class="layer-control">
											<input type="radio" id="pm10-layer" name="pollutant" value="pm10">
											<label for="pm10-layer">PM10 Concentration (2020)</label>
										</div>
									</div>
									<div class="col-3 col-12-medium">
										<h3>Map Types</h3>
										<div class="layer-control">
											<input type="radio" id="concentration-map" name="maptype" value="concentration" checked>
											<label for="concentration-map">Concentration Classes</label>
										</div>
										<div class="layer-control">
											<input type="radio" id="bivariate-map" name="maptype" value="bivariate">
											<label for="bivariate-map">Bivariate (Pollution vs Population)</label>
										</div>
										<div class="layer-control">
											<input type="radio" id="aad-map" name="maptype" value="aad">
											<label for="aad-map">Annual Average Difference (2022)</label>
										</div>
									</div>
									<div class="col-3 col-12-medium">
										<h3>Overlay Layers</h3>
										<div class="layer-control">
											<input type="checkbox" id="admin-boundaries" checked>
											<label for="admin-boundaries">Administrative Boundaries</label>
										</div>
										<div class="layer-control">
											<input type="checkbox" id="population-layer">
											<label for="population-layer">Population Density</label>
										</div>
										<div class="layer-control">
											<input type="checkbox" id="landcover-layer">
											<label for="landcover-layer">Land Cover (2022)</label>
										</div>
									</div>
									<div class="col-3 col-12-medium">
										<h3>Map Settings</h3>
										<div class="layer-control">
											<label for="opacity-slider">Layer Opacity:</label>
											<input type="range" id="opacity-slider" min="0" max="1" step="0.1" value="0.8">
											<span id="opacity-value">80%</span>
										</div>
										<div class="layer-control">
											<button id="reset-view" class="button small">Reset View</button>
											<button id="fullscreen" class="button small">Fullscreen</button>
										</div>
									</div>
								</div>
							</div>

							<!-- Interactive Map -->
							<div id="map"></div>

							<!-- Legend and Charts Section -->
							<div class="row" style="margin-top: 2em;">
								<div class="col-6 col-12-medium">
									<div class="legend">
										<h3>Legend</h3>
										<div id="concentration-legend">
											<h4>Concentration Classes (μg/m³)</h4>
											<div class="row">
												<div class="col-6">
													<div style="background: #2E8B57; color: white; padding: 5px; margin: 2px;">Class 1: ≤ 10 (Good)</div>
													<div style="background: #FFD700; padding: 5px; margin: 2px;">Class 2: 10-25 (Moderate)</div>
													<div style="background: #FF8C00; color: white; padding: 5px; margin: 2px;">Class 3: 25-40 (Unhealthy for Sensitive)</div>
												</div>
												<div class="col-6">
													<div style="background: #DC143C; color: white; padding: 5px; margin: 2px;">Class 4: 40-50 (Unhealthy)</div>
													<div style="background: #8B0000; color: white; padding: 5px; margin: 2px;">Class 5: > 50 (Very Unhealthy)</div>
												</div>
											</div>
										</div>
										
										<div id="bivariate-legend" style="display: none;">
											<h4>Bivariate Legend</h4>
											<p>Pollution vs Population</p>
											<div class="bivariate-legend">
												<div class="legend-cell" style="background: #e8e8e8;">1,1</div>
												<div class="legend-cell" style="background: #b8d6e8;">1,2</div>
												<div class="legend-cell" style="background: #88c4e8;">1,3</div>
												<div class="legend-cell" style="background: #58b2e8;">1,4</div>
												<div class="legend-cell" style="background: #28a0e8;">1,5</div>
												<div class="legend-cell" style="background: #e8d6b8;">2,1</div>
												<div class="legend-cell" style="background: #d6c4a8;">2,2</div>
												<div class="legend-cell" style="background: #c4b298;">2,3</div>
												<div class="legend-cell" style="background: #b2a088;">2,4</div>
												<div class="legend-cell" style="background: #a08e78;">2,5</div>
												<div class="legend-cell" style="background: #e8c488;">3,1</div>
												<div class="legend-cell" style="background: #d6b278;">3,2</div>
												<div class="legend-cell" style="background: #c4a068;">3,3</div>
												<div class="legend-cell" style="background: #b28e58;">3,4</div>
												<div class="legend-cell" style="background: #a07c48;">3,5</div>
												<div class="legend-cell" style="background: #e8b258;">4,1</div>
												<div class="legend-cell" style="background: #d6a048;">4,2</div>
												<div class="legend-cell" style="background: #c48e38;">4,3</div>
												<div class="legend-cell" style="background: #b27c28;">4,4</div>
												<div class="legend-cell" style="background: #a06a18;">4,5</div>
												<div class="legend-cell" style="background: #e8a028;">5,1</div>
												<div class="legend-cell" style="background: #d68e18;">5,2</div>
												<div class="legend-cell" style="background: #c47c08;">5,3</div>
												<div class="legend-cell" style="background: #b26a00;">5,4</div>
												<div class="legend-cell" style="background: #a05800;">5,5</div>
											</div>
											<div style="margin-top: 10px;">
												<div style="font-size: 12px;">
													<span style="float: left;">Low Population</span>
													<span style="float: right;">High Population</span>
													<div style="clear: both; text-align: center; margin-top: 10px;">
														<div>High Pollution ↑</div>
														<div style="margin-top: 20px;">Low Pollution ↓</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								
								<div class="col-6 col-12-medium">
									<div class="legend">
										<h3>Population Exposure Chart</h3>
										<div id="exposure-chart">
											<!-- Placeholder for dynamic chart -->
											<div style="background: #f4f4f4; padding: 2em; text-align: center; border: 2px dashed #ddd;">
												<p><strong>Population Exposure Distribution</strong><br />
												<em>Pie chart showing population percentage in each concentration class</em><br />
												<small>Chart updates based on selected pollutant</small></p>
											</div>
										</div>
									</div>
								</div>
							</div>

							<!-- Time Series Analysis -->
							<section style="margin-top: 2em;">
								<h2>Temporal Analysis</h2>
								<div class="row">
									<div class="col-8 col-12-medium">
										<div class="box">
											<h3>Time Series Trends (2013-2022)</h3>
											<!-- Placeholder for interactive time series chart -->
											<div style="background: #f4f4f4; padding: 2em; text-align: center; border: 2px dashed #ddd;">
												<p><strong>Interactive Time Series Chart</strong><br />
												<em>Annual average concentrations by land cover class</em><br />
												<small>Click on map features to update chart for specific regions</small></p>
											</div>
										</div>
									</div>
									<div class="col-4 col-12-medium">
										<h3>Analysis Controls</h3>
										<div class="layer-control">
											<label for="year-slider">Year:</label>
											<input type="range" id="year-slider" min="2013" max="2022" value="2020">
											<span id="year-value">2020</span>
										</div>
										<div class="layer-control">
											<label for="land-cover-filter">Land Cover Filter:</label>
											<select id="land-cover-filter">
												<option value="all">All Classes</option>
												<option value="settlement">Settlement</option>
												<option value="cropland">Cropland</option>
												<option value="grassland">Grassland</option>
												<option value="forest">Forest</option>
												<option value="wetland">Wetland</option>
												<option value="other">Other Lands</option>
											</select>
										</div>
										<div class="layer-control">
											<button id="download-data" class="button">Download Data</button>
										</div>
									</div>
								</div>
							</section>

							<!-- Data Information -->
							<section>
								<h2>Data Information</h2>
								<div class="row">
									<div class="col-6 col-12-medium">
										<h3>Datasets</h3>
										<ul>
											<li><strong>Air Quality:</strong> CAMS European Reanalysis (2013-2022)</li>
											<li><strong>Population:</strong> WorldPop 2020 (100m resolution)</li>
											<li><strong>Land Cover:</strong> ESA CCI Land Cover 2022</li>
											<li><strong>Boundaries:</strong> FAO GAUL Level 2</li>
										</ul>
									</div>
									<div class="col-6 col-12-medium">
										<h3>Technical Details</h3>
										<ul>
											<li><strong>Coordinate System:</strong> WGS84 (EPSG:4326)</li>
											<li><strong>Spatial Resolution:</strong> ~1km for air quality data</li>
											<li><strong>Temporal Coverage:</strong> 2013-2022 (monthly averages)</li>
											<li><strong>Health Guidelines:</strong> EU limits and WHO AQG</li>
										</ul>
									</div>
								</div>
							</section>

							<!-- Instructions -->
							<section>
								<h2>How to Use the WebGIS</h2>
								<div class="features">
									<section>
										<span class="icon solid major fa-mouse-pointer"></span>
										<h3>Navigation</h3>
										<p>Use mouse to pan and zoom. Double-click to zoom in. Use mouse wheel for precise zoom control.</p>
									</section>
									<section>
										<span class="icon solid major fa-layer-group"></span>
										<h3>Layer Control</h3>
										<p>Switch between pollutants and map types using radio buttons. Toggle overlay layers with checkboxes.</p>
									</section>
									<section>
										<span class="icon solid major fa-info-circle"></span>
										<h3>Feature Information</h3>
										<p>Click on map features to view detailed information and update charts for specific regions.</p>
									</section>
									<section>
										<span class="icon solid major fa-chart-line"></span>
										<h3>Temporal Analysis</h3>
										<p>Use the year slider to explore temporal changes. Filter by land cover types for focused analysis.</p>
									</section>
								</div>
							</section>

							<!-- Navigation -->
							<section>
								<ul class="actions fit">
									<li><a href="pm10.html" class="button">← Previous: PM10 Analysis</a></li>
									<li><a href="index.html" class="button primary">Back to Home</a></li>
								</ul>
							</section>

						</div>
					</section>

			</div>

		<!-- Footer -->
			<footer id="footer" class="wrapper alt">
				<div class="inner">
					<ul class="menu">
						<li>&copy; 2025 GIS Lab Project. All rights reserved.</li>
						<li>Template: <a href="http://html5up.net">HTML5 UP</a></li>
						<li>Data: <a href="https://atmosphere.copernicus.eu/">Copernicus CAMS</a></li>
					</ul>
				</div>
			</footer>

		<!-- Scripts -->
			<script src="https://cdn.jsdelivr.net/npm/ol@8.2.0/dist/ol.js"></script>
			<script src="assets/js/jquery.min.js"></script>
			<script src="assets/js/jquery.scrollex.min.js"></script>
			<script src="assets/js/jquery.scrolly.min.js"></script>
			<script src="assets/js/browser.min.js"></script>
			<script src="assets/js/breakpoints.min.js"></script>
			<script src="assets/js/util.js"></script>
			<script src="assets/js/main.js"></script>
			
			<script>
				// WebGIS Functionality
				let map, currentLayer;
				
				// Initialize map
				function initMap() {
					map = new ol.Map({
						target: 'map',
						layers: [
							new ol.layer.Tile({
								source: new ol.source.OSM()
							})
						],
						view: new ol.View({
							center: ol.proj.fromLonLat([10.0, 45.0]), // Centered on Northern Italy
							zoom: 6
						})
					});
					
					// Add default NO2 layer
					addPollutantLayer('no2', 'concentration');
				}
				
				// Add pollutant layer from GeoServer
				function addPollutantLayer(pollutant, mapType) {
					// Remove existing pollutant layer
					if (currentLayer) {
						map.removeLayer(currentLayer);
					}
					
					// Construct layer name based on selections
					let layerName = `air_quality:${getCountryCode()}_${pollutant}_2020_${mapType}`;
					
					currentLayer = new ol.layer.Tile({
						source: new ol.source.TileWMS({
							url: 'http://localhost:8080/geoserver/air_quality/wms', // Update with your GeoServer URL
							params: {
								'LAYERS': layerName,
								'TILED': true
							},
							serverType: 'geoserver'
						}),
						opacity: parseFloat(document.getElementById('opacity-slider').value)
					});
					
					map.addLayer(currentLayer);
				}
				
				// Get country code based on case study
				function getCountryCode() {
					// This should be dynamically set based on your group's assigned country
					return 'italy'; // Example - replace with your country
				}
				
				// Event listeners
				document.addEventListener('DOMContentLoaded', function() {
					initMap();
					
					// Pollutant layer controls
					document.querySelectorAll('input[name="pollutant"]').forEach(radio => {
						radio.addEventListener('change', function() {
							if (this.checked) {
								const mapType = document.querySelector('input[name="maptype"]:checked').value;
								addPollutantLayer(this.value, mapType);
								updateLegend(this.value, mapType);
							}
						});
					});
					
					// Map type controls
					document.querySelectorAll('input[name="maptype"]').forEach(radio => {
						radio.addEventListener('change', function() {
							if (this.checked) {
								const pollutant = document.querySelector('input[name="pollutant"]:checked').value;
								addPollutantLayer(pollutant, this.value);
								updateLegend(pollutant, this.value);
							}
						});
					});
					
					// Opacity control
					document.getElementById('opacity-slider').addEventListener('input', function() {
						if (currentLayer) {
							currentLayer.setOpacity(this.value);
						}
						document.getElementById('opacity-value').textContent = Math.round(this.value * 100) + '%';
					});
					
					// Reset view button
					document.getElementById('reset-view').addEventListener('click', function() {
						map.getView().setCenter(ol.proj.fromLonLat([10.0, 45.0]));
						map.getView().setZoom(6);
					});
					
					// Year slider
					document.getElementById('year-slider').addEventListener('input', function() {
						document.getElementById('year-value').textContent = this.value;
						// Update temporal visualization
					});
				});
				
				// Update legend based on current selections
				function updateLegend(pollutant, mapType) {
					const concentrationLegend = document.getElementById('concentration-legend');
					const bivariateLegend = document.getElementById('bivariate-legend');
					
					if (mapType === 'bivariate') {
						concentrationLegend.style.display = 'none';
						bivariateLegend.style.display = 'block';
					} else {
						concentrationLegend.style.display = 'block';
						bivariateLegend.style.display = 'none';
					}
				}
			</script>

	</body>
</html>